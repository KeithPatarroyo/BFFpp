<!DOCTYPE html>
<html>
<head>
    <title>BFF Grid with Token Tracking - Live Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff00;
        }

        .stats {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .stat-row {
            display: flex;
            gap: 20px;
            margin: 5px 0;
        }

        .stat {
            flex: 1;
        }

        .stat-label {
            color: #00aa00;
            font-size: 11px;
        }

        .stat-value {
            color: #00ff00;
            font-size: 16px;
            font-weight: bold;
        }

        .visualization-area {
            flex: 1;
            display: flex;
            gap: 10px;
            min-height: 0;
        }

        .grid-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            color: #00ff00;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
            text-shadow: 0 0 5px #00ff00;
        }

        .canvas-container {
            flex: 1;
            border: 2px solid #00ff00;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            max-width: 100%;
            max-height: 100%;
        }

        .status {
            margin-top: 10px;
            padding: 8px;
            background: #1a1a1a;
            border: 1px solid #00ff00;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }

        .status.connected {
            color: #00ff00;
        }

        .status.disconnected {
            color: #ff0000;
            border-color: #ff0000;
        }

        .info-badge {
            display: inline-block;
            background: #003300;
            padding: 2px 8px;
            border-radius: 3px;
            margin-left: 10px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§¬ BFF Grid with Token Tracking - Live Evolution</h1>

        <div class="stats">
            <div class="stat-row">
                <div class="stat">
                    <div class="stat-label">EPOCH</div>
                    <div class="stat-value" id="epoch">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">GRID SIZE</div>
                    <div class="stat-value" id="grid-size">-</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ENTROPY (HOE)</div>
                    <div class="stat-value" id="entropy">0.000000</div>
                </div>
                <div class="stat">
                    <div class="stat-label">TOTAL PROGRAMS</div>
                    <div class="stat-value" id="total-programs">-</div>
                </div>
            </div>
        </div>

        <div class="visualization-area">
            <div class="grid-section">
                <div class="section-title">
                    EVOLUTIONARY GRID
                    <span class="info-badge">Token lineage tracked per character</span>
                </div>
                <div class="canvas-container">
                    <canvas id="grid-canvas"></canvas>
                </div>
            </div>
        </div>

        <div class="status disconnected" id="status">
            âš  Connecting to server...
        </div>
    </div>

    <script>
        const canvas = document.getElementById('grid-canvas');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');

        let gridWidth = 0;
        let gridHeight = 0;
        let gridData = null;

        // WebSocket connection
        const ws = new WebSocket('ws://localhost:8080');

        ws.onopen = () => {
            statusEl.textContent = 'âœ“ Connected - Receiving live updates';
            statusEl.className = 'status connected';
        };

        ws.onclose = () => {
            statusEl.textContent = 'âœ— Disconnected from server';
            statusEl.className = 'status disconnected';
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            statusEl.textContent = 'âœ— Connection error';
            statusEl.className = 'status disconnected';
        };

        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                updateVisualization(data);
            } catch (error) {
                console.error('Error parsing message:', error);
            }
        };

        function updateVisualization(data) {
            // Update stats
            document.getElementById('epoch').textContent = data.epoch;
            document.getElementById('grid-size').textContent = `${data.width}Ã—${data.height}`;
            document.getElementById('entropy').textContent = data.entropy.toFixed(6);
            document.getElementById('total-programs').textContent = data.width * data.height;

            // Update grid
            gridWidth = data.width;
            gridHeight = data.height;
            gridData = data.grid;

            drawGrid();
        }

        function drawGrid() {
            if (!gridData) return;

            // Calculate canvas size to fit container
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth - 20;
            const containerHeight = container.clientHeight - 20;

            const cellSize = Math.floor(Math.min(
                containerWidth / gridWidth,
                containerHeight / gridHeight
            ));

            const canvasWidth = gridWidth * cellSize;
            const canvasHeight = gridHeight * cellSize;

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // Draw grid
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const [r, g, b] = gridData[y][x];
                    ctx.fillStyle = `rgb(${r},${g},${b})`;
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        // Redraw on window resize
        window.addEventListener('resize', () => {
            if (gridData) {
                drawGrid();
            }
        });
    </script>
</body>
</html>
